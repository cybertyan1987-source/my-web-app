<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>English Materials ‚Äî Telegram WebApp</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg-color:#ffffff;
  --bg-block:#f2f2f2;
  --text-color:#222;
  --button-bg:#2563eb;
  --button-text:#fff;
}

body{
  font-family: system-ui;
  margin:0;
  padding:16px;
  background: var(--bg-color);
  color: var(--text-color);
}

h1{ font-size:1.3rem; margin-bottom:20px; }
h2{ margin-top:25px; font-size:1.1rem; }

.block{
  margin-bottom:25px;
  background: var(--bg-block);
  padding:15px;
  border-radius:10px;
}

select{
  width:100%;
  padding:10px;
  font-size:1rem;
  border-radius:6px;
  border:1px solid #ccc;
  margin-bottom:10px;
}

.card{
  margin-top:15px;
  padding:12px;
  border-radius:10px;
  background: var(--bg-color);
  border:1px solid rgba(0,0,0,0.1);
  display:flex;
  gap:12px;
  align-items:flex-start;
}

.card img{ width:90px; height:130px; object-fit:cover; border-radius:6px; }
.card h3{ margin:0 0 8px; font-size:1.05rem; }
.card p{ margin:6px 0; font-size:0.95rem; }

.download-btn{
  margin-top:10px;
  padding:8px 12px;
  font-size:1rem;
  background:var(--button-bg);
  color:var(--button-text);
  border:none;
  border-radius:6px;
  cursor:pointer;
  display:none;
}

.hint{ font-size:0.9rem; color:#666; margin-bottom:12px; }
</style>
</head>

<body>

<h1>üìö English Study Materials</h1>
<div class="hint">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–∏—é –∏ —É—Ä–æ–≤–µ–Ω—å/–∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–Ω–∏–≥—É. –ù–∞–∂–º–∏—Ç–µ "–°–∫–∞—á–∞—Ç—å" –∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤—ã–±–æ—Ä –∫–Ω–æ–ø–∫–æ–π Telegram –≤–Ω–∏–∑—É.</div>

<div id="app"></div>

<script>
// --- –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —É—Ä–æ–≤–Ω–µ–π ---
const DATA = {
  books: {
    "English File": {
      levels: {
        A1:{desc:"English File Beginner", file:"files/EF_A1.pdf", img:"EF+1.jpg"},
        A2:{desc:"English File Elementary", file:"files/EF_A2.pdf", img:"EF+2.jpg"},
        B1:{desc:"English File Intermediate", file:"files/EF_B1.pdf", img:"EF+3.jpg"}
      }
    },
    "Solutions": {
      levels: {
        A1:{desc:"Solutions Beginner", file:"files/Sol_A1.pdf", img:"https://via.placeholder.com/300x450?text=Sol+A1"},
        B1:{desc:"Solutions Intermediate", file:"files/Sol_B1.pdf", img:"https://via.placeholder.com/300x450?text=Sol+B1"}
      }
    }
  },
  magazines: {
    "Learn Hot English": {
      levels: {Issue1:{desc:"–ñ—É—Ä–Ω–∞–ª Learn Hot English #1", file:"files/LHE1.pdf", img:"https://via.placeholder.com/300x450?text=LHE1"}}
    },
    "Speak Out": {
      levels: {Issue1:{desc:"–ñ—É—Ä–Ω–∞–ª Speak Out #1", file:"files/SO1.pdf", img:"https://via.placeholder.com/300x450?text=SO1"}}
    }
  },
  dictionaries: {
    "Oxford Dictionary": {
      levels: {Full:{desc:"Oxford Learner's Dictionary", file:"files/OxfordDict.pdf", img:"https://via.placeholder.com/300x450?text=Oxford"}}
    },
    "Cambridge Dictionary": {
      levels: {Full:{desc:"Cambridge Dictionary", file:"files/CambridgeDict.pdf", img:"https://via.placeholder.com/300x450?text=Cambridge"}}
    }
  },
  grammar: {
    "Murphy Grammar": {levels:{Full:{desc:"English Grammar in Use", file:"files/Murphy.pdf", img:"https://via.placeholder.com/300x450?text=Murphy"}}},
    "Practical English Usage": {levels:{Full:{desc:"Practical English Usage Swan", file:"files/PEU.pdf", img:"https://via.placeholder.com/300x450?text=PEU"}}}
  }
};

// --- –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ---
const categories = Object.keys(DATA);
const app = document.getElementById('app');

// –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
const selections = {};

categories.forEach(cat=>{
  const block = document.createElement('div');
  block.className='block';
  block.innerHTML=`<h2>${cat.charAt(0).toUpperCase()+cat.slice(1)}</h2>
    <select class="seriesSelect">
      <option value="">‚Äî –≤—ã–±—Ä–∞—Ç—å —Å–µ—Ä–∏—é ‚Äî</option>
    </select>
    <select class="levelSelect" style="display:none;"><option value="">‚Äî –≤—ã–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å ‚Äî</option></select>
    <div class="cardContainer"></div>
    <button class="download-btn">–°–∫–∞—á–∞—Ç—å</button>
  `;
  app.appendChild(block);

  const seriesSelect = block.querySelector('.seriesSelect');
  const levelSelect = block.querySelector('.levelSelect');
  const cardContainer = block.querySelector('.cardContainer');
  const downloadBtn = block.querySelector('.download-btn');

  // –∑–∞–ø–æ–ª–Ω—è–µ–º —Å–µ—Ä–∏–∏
  Object.keys(DATA[cat]).forEach(ser=>{
    const opt = document.createElement('option');
    opt.value = ser;
    opt.textContent = ser;
    seriesSelect.appendChild(opt);
  });

  let currentItem = null;

  // –≤—ã–±–æ—Ä —Å–µ—Ä–∏–∏
  seriesSelect.addEventListener('change', ()=>{
    const key = seriesSelect.value;
    levelSelect.innerHTML = '<option value="">‚Äî –≤—ã–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å ‚Äî</option>';
    cardContainer.innerHTML='';
    downloadBtn.style.display='none';
    if(!key){ levelSelect.style.display='none'; return; }

    const levels = DATA[cat][key].levels;
    Object.keys(levels).forEach(lvl=>{
      const opt = document.createElement('option');
      opt.value = lvl;
      opt.textContent = lvl;
      levelSelect.appendChild(opt);
    });
    levelSelect.style.display='block';
  });

  // –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è
  levelSelect.addEventListener('change', ()=>{
    const seriesKey = seriesSelect.value;
    const levelKey = levelSelect.value;
    if(!levelKey){ cardContainer.innerHTML=''; downloadBtn.style.display='none'; return; }

    currentItem = DATA[cat][seriesKey].levels[levelKey];
    cardContainer.innerHTML=`<div class="card"><img src="${currentItem.img}"><div class="meta"><h3>${seriesKey} ${levelKey}</h3><p>${currentItem.desc}</p></div></div>`;
    downloadBtn.style.display='inline-block';

    // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ selections
    selections[cat] = {series:seriesKey, level:levelKey, file:currentItem.file};
  });

  // –∫–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∞—Ç—å
  downloadBtn.addEventListener('click', ()=>{
    if(!currentItem) return;
    const a = document.createElement('a');
    a.href = currentItem.file;
    a.download = currentItem.file.split('/').pop();
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });
});

// --- Telegram WebApp ---
const tg = Telegram.WebApp;
tg.expand();
const theme = tg.colorScheme;
if(theme==="dark"){
  document.documentElement.style.setProperty("--bg-color","#1e1e1e");
  document.documentElement.style.setProperty("--bg-block","#2a2a2a");
  document.documentElement.style.setProperty("--text-color","#fff");
  document.documentElement.style.setProperty("--button-bg","#0a84ff");
  document.documentElement.style.setProperty("--button-text","#fff");
}

// --- MainButton –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ ---
tg.MainButton.text = "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä";
tg.MainButton.color = getComputedStyle(document.documentElement).getPropertyValue("--button-bg");
tg.MainButton.textColor = getComputedStyle(document.documentElement).getPropertyValue("--button-text");
tg.MainButton.show();

tg.MainButton.onClick(()=>{
  tg.sendData(JSON.stringify(selections));
  alert("–í—ã–±—Ä–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É:\n"+JSON.stringify(selections,null,2));
});
</script>

</body>
</html>
